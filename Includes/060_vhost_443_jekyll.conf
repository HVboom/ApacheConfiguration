<VirtualHost *:443>
  ServerName jekyll.HVboom.org

  ProxyRequests Off  <-- this is an important security setting
  ProxyPreserveHost   On

  # ProxyPass           /admin/      http://localhost:8001/admin/
  # ProxyPassReverse    /admin/      http://localhost:8001/admin/
  # ProxyPass           /_api/       http://localhost:8001/_api/
  # ProxyPassReverse    /_api/       http://localhost:8001/_api/
  ProxyPass           /   http://localhost:8001/
  ProxyPassReverse    /   http://localhost:8001/

  <Proxy http://localhost:8001>
    Require all granted
    Options none
  </Proxy>

  <Location />
    # LogLevel debug proxy_html:trace3

    ProxyHTMLEnable On
    ProxyHTMLExtended On
    SetOutputFilter INFLATE;proxy-html;substitute;DEFLATE
    ProxyHTMLURLMap http://localhost:8001/ /

    Substitute "s|http://localhost:8001|https://jekyll.HVboom.org|ni"
  </Location>

  SSLEngine on
  SSLCertificateFile      /usr/local/etc/letsencrypt/live/hvboom.org/fullchain.pem
  SSLCertificateKeyFile   /usr/local/etc/letsencrypt/live/hvboom.org/privkey.pem

  RequestHeader add X-Forwarded-Ssl on

  <IfModule headers_module>
    Header always edit Set-Cookie ^(.*)$ $1;HttpOnly;Secure
    Header always set Strict-Transport-Security "max-age=15768000; includeSubDomains"
  </IfModule>
</VirtualHost>
