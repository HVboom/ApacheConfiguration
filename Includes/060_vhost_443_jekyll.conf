<VirtualHost *:443>
  ServerName jekyll.HVboom.org

  ProxyRequests Off  <-- this is an important security setting
  ProxyPreserveHost   On

  ProxyPass           /Homepage/   http://localhost:8001/Homepage/
  ProxyPassReverse    /Homepage/   http://localhost:8001/Homepage/

  <Proxy http://localhost:8001>
    Require all granted
    Options none
  </Proxy>

  <Location "/Homepage/_api/">
    ProxyPass           http://localhost:8001/_api/
    ProxyPassReverse    http://localhost:8001/_api/

    SetOutputFilter INFLATE;substitute;DEFLATE

    Substitute "s|http://localhost:8001|https://jekyll.HVboom.org|ni"
  </Location>

  <Location "/Homepage/admin/">
    ProxyPass           http://localhost:8001/admin/
    ProxyPassReverse    http://localhost:8001/admin/

    AddOutputFilterByType INFLATE;substitute;DEFLATE text/html
    AddOutputFilterByType INFLATE;substitute;DEFLATE text/css
    AddOutputFilterByType INFLATE;substitute;DEFLATE application/javascript

    Substitute "s|/admin|/Homepage/admin|ni"
    Substitute "s|/_api|/Homepage/_api|ni"
  </Location>

  SSLEngine on
  SSLCertificateFile      /usr/local/etc/letsencrypt/live/hvboom.org/fullchain.pem
  SSLCertificateKeyFile   /usr/local/etc/letsencrypt/live/hvboom.org/privkey.pem

  RequestHeader add X-Forwarded-Ssl on

  <IfModule headers_module>
    Header always edit Set-Cookie ^(.*)$ $1;HttpOnly;Secure
    Header always set Strict-Transport-Security "max-age=15768000; includeSubDomains"
  </IfModule>
</VirtualHost>
